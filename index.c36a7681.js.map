{"mappings":"AA2DA,MAAMA,EAAW,IAtDjB,MACEC,YAAYC,EAAMC,GAChBC,KAAKF,KAAOA,EACZE,KAAKD,SAAWA,EAChBC,KAAKC,MAAQC,GAAGC,WAAW,SAC3BH,KAAKI,W,CAIPC,cAAcC,GAEZ,MAAMC,EAAM,IAAIC,KACVC,EAAO,CACXH,QAASA,EACTP,SAAUC,KAAKD,SACfD,KAAME,KAAKF,KACXY,WAAYC,SAASC,UAAUC,UAAUC,SAASP,IAKpD,aADuBP,KAAKC,MAAMc,IAAIN,E,CAKxCO,SAASC,GACPjB,KAAKI,YAAcJ,KAAKC,MACrBiB,MAAM,OAAQ,KAAMlB,KAAKF,MACzBqB,QAAQ,cACRC,YAAWC,IACVA,EAASC,aAAaC,SAAQC,IACV,UAAdA,EAAKC,MAEPR,EAASO,EAAKE,IAAIC,OAAO,GAE3B,G,CAKRC,WAAW7B,GACTC,KAAKD,SAAWA,C,CAIlB8B,WAAW/B,GACTE,KAAKF,KAAOA,EACZgC,QAAQC,IAAI,iBACR/B,KAAKI,aACPJ,KAAKI,a,GAKmB,UAAW,SAEzCR,EAASoB,UAASW,IAChBG,QAAQC,IAAIJ,EAAK,IAGnBK,YAAW,KACTpC,EAASiC,WAAW,UACpBjC,EAASgC,WAAW,OACpBhC,EAASoB,UAASW,GAAQG,QAAQC,IAAIJ,KACtC/B,EAASqC,QAAQ,2BAA2B,GAC3C","sources":["src/scripts/chat.js"],"sourcesContent":["// TODO adding new chat documents\n// TODO setting up a real-time listener to get new chats\n// TODO updating the username\n// TODO updating the room\n\nclass Chatroom {\n  constructor(room, username) {\n    this.room = room;\n    this.username = username;\n    this.chats = db.collection('chats');\n    this.unsubscribe;\n  }\n\n  //*   metoda addChat (adauga un mesaj):\n  async addChat(message) {\n    //* format a chat object:\n    const now = new Date();\n    const chat = {\n      message: message,\n      username: this.username,\n      room: this.room,\n      created_at: firebase.firestore.Timestamp.fromDate(now), // Setăm data curentă.\n    };\n\n    //* save the chat document:\n    const response = await this.chats.add(chat);\n    return response;\n  }\n\n  //* metoda getChats (actualizeaza in timp real mesajele):\n  getChats(callback) {\n    this.unsubscribe = this.chats\n      .where('room', '==', this.room)\n      .orderBy('created_at')\n      .onSnapshot(snapshot => {\n        snapshot.docChanges().forEach(elem => {\n          if (elem.type === 'added') {\n            //* update the UI:\n            callback(elem.doc.data());\n          }\n        });\n      });\n  }\n\n  //*   metoda update username:\n  updateName(username) {\n    this.username = username;\n  }\n\n  //*   update the chatroom:\n  updateRoom(room) {\n    this.room = room;\n    console.log('room updated!');\n    if (this.unsubscribe) {\n      this.unsubscribe();\n    }\n  }\n}\n\nconst chatroom = new Chatroom('general', 'shaun');\n\nchatroom.getChats(data => {\n  console.log(data);\n});\n\nsetTimeout(() => {\n  chatroom.updateRoom('gaming');\n  chatroom.updateName('DAN');\n  chatroom.getChats(data => console.log(data));\n  chatroom.addChat('HELLO FROM NEW CHATROOM!');\n}, 3000);\n"],"names":["$0b3261060f96e267$var$chatroom","constructor","room","username","this","chats","db","collection","unsubscribe","async","message","now","Date","chat","created_at","firebase","firestore","Timestamp","fromDate","add","getChats","callback","where","orderBy","onSnapshot","snapshot","docChanges","forEach","elem","type","doc","data","updateName","updateRoom","console","log","setTimeout","addChat"],"version":3,"file":"index.c36a7681.js.map"}